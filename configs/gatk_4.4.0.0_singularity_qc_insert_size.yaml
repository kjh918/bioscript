# =========================================================
# (4) GATK4 CollectInsertSizeMetrics (jar 호출 + PDF histogram)
#     + LC_ALL 설정은 cmd_line에 포함
# =========================================================
tool:
  name: gatk4
  version: "4.4.0.0"
  profile: "singularity_qc_insert_size"

io:
  inputs:
    SeqID:          { required: true }
    BamDir:         { required: true }
    qcResDir:       { required: true }
    ReferenceFasta: { required: true }

  outputs:
    insert_size_metrics_txt:
      default: "[qcResDir]/[SeqID].insert.size.metrics.txt"
    insert_size_hist_pdf:
      default: "[qcResDir]/[SeqID].insert.size.histogram.pdf"

params:
  bind:       { type: str, default: "/storage,/data" }
  sif:        { type: str, default: "/storage/images/gatk-4.4.0.0.sif" }
  Threads:    { type: int, default: 14 }
  xmx_mb:     { type: int, default: 16384 }

  gatk_jar:   { type: str, default: "/gatk/gatk-package-4.4.0.0-local.jar" }
  java_bin:   { type: str, default: "java" }
  lc_all:     { type: str, default: "en_US.UTF-8" }

cmd_line: >
  export LC_ALL=[lc_all]
  &&
  singularity exec -B [bind] [sif] [java_bin]
  -XX:ParallelGCThreads=[Threads]    -Xmx[xmx_mb]m
  -jar [gatk_jar] CollectInsertSizeMetrics
  --INPUT [BamDir]/[SeqID].analysisReady.bam
  --OUTPUT [qcResDir]/[SeqID].insert.size.metrics.txt
  --Histogram_FILE [qcResDir]/[SeqID].insert.size.histogram.pdf
  --REFERENCE_SEQUENCE [ReferenceFasta]
