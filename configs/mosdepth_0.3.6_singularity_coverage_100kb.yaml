# =========================================================
# mosdepth: Fast BAM/CRAM depth calculation
#  - Generates global distribution and quantized/thresholded depth
#  - Flexible input via InputSuffix (e.g., analysisReady, recal, sorted)
#  - Prefix-based output management for multi-step QC
# =========================================================
tool:
  name: mosdepth
  version: "0.3.6"
  profile: "singularity_coverage"

io:
  inputs:
    SeqID:    { required: true, help: "Sequence identifier used for file tracking" }
    BamDir:   { required: true, help: "Directory containing the BAM file to be analyzed" }
    qcResDir: { required: true, help: "Output directory for coverage results" }

  outputs:
    # prefix 자체를 출력 토큰으로 정의하여 커맨드라인에서 참조
    prefix:             { default: "[qcResDir]/[SeqID].[InputSuffix]", help: "Output prefix for all mosdepth result files" }
    regions_bed_gz:     { default: "[prefix].regions.bed.gz", help: "Compressed BED file containing region depth" }
    regions_bed_gz_csi: { default: "[prefix].regions.bed.gz.csi", help: "Index file for the regions BED" }
    summary_txt:        { default: "[prefix].mosdepth.summary.txt", help: "Summary of mean depths per chromosome/region" }
    global_dist_txt:    { default: "[prefix].global.dist.txt", help: "Global distribution of coverage" }

params:
  # --- [Suffix 제어] ---
  # 기본 분석 대상은 최종 분석 준비 완료(analysisReady) BAM입니다.
  InputSuffix: { type: str, default: "analysisReady", help: "Suffix of the input BAM (e.g., analysisReady, recal, sorted)" }

  # --- [Binaries & Container] ---
  singularity_bin: { type: str, default: "singularity", help: "Path to singularity executable" }
  mosdepth_bin:    { type: str, default: "/opt/mosdepth", help: "Path to mosdepth binary inside container" }
  sif:             { type: str, default: "/storage/images/mosdepth-0.3.6.sif", help: "mosdepth singularity image file" }
  bind:            { type: str, default: "/storage,/data", help: "Mount paths for singularity" }

  # --- [Resources & Options] ---
  Threads:       { type: int, default: 8, help: "Number of threads for decompression and processing" }
  bin:           { type: int, default: 100000, help: "Window size for quantized output (used with --by)" }
  mapq:          { type: int, default: 20, help: "Minimum mapping quality for a read to be counted" }
  mosdepth_args: { type: str, default: "--no-per-base --fast-mode", help: "Additional mosdepth arguments" }

cmd_line: >
  [singularity_bin] exec -B [bind] [sif] [mosdepth_bin]
  --threads [Threads]
  [mosdepth_args]
  --by [bin]
  --mapq [mapq]
  [prefix]
  [BamDir]/[SeqID].[InputSuffix].bam