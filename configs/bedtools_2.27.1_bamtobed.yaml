# =========================================================
# bedtools bamtobed conversion pipeline
#  - Converts BAM to BED for region-based analysis/visualization
#  - Performs bgzip compression and generates symbolic links
#  - Delivers final BED to a designated directory
# =========================================================
tool:
  name: bedtools 
  version: "2.27.1"
  profile: "bamtobed"

io:
  inputs:
    SeqID:       { required: true, help: "Sequence identifier used for file naming" }
    BamDir:      { required: true, help: "Directory containing the input BAM file" }
    BamToBedDir: { required: true, help: "Target directory for final delivery of BED files" }
    
  outputs:
    # 중간 생성되는 압축 파일과 최종 배포 파일을 구분하여 정의
    bed_gz:      { default: "[BamDir]/[SeqID].[InputSuffix].bed.gz", help: "Compressed BED file in the working directory" }
    final_bed:   { default: "[BamToBedDir]/[SeqID].bed.gz", help: "Final BED file delivered to the target directory" }

params:
  # --- [Suffix 제어] ---
  InputSuffix:   { type: str, default: "analysisReady", help: "Suffix of the input BAM (e.g., analysisReady, recal, sorted)" }

  # --- [Binaries & Resources] ---
  bedtools_bin:  { type: str, default: "bedtools", help: "Path to bedtools binary" }
  bgzip_bin:     { type: str, default: "bgzip", help: "Path to bgzip binary" }
  ln_bin:        { type: str, default: "ln", help: "Path to ln binary" }
  cp_bin:        { type: str, default: "cp", help: "Path to cp binary" }
  Threads:       { type: int, default: 8, help: "Number of threads for bgzip compression" }
  
cmd_line: >
  [bedtools_bin] bamtobed -i [BamDir]/[SeqID].[InputSuffix].bam > [BamDir]/[SeqID].[InputSuffix].bed
  &&
  [bgzip_bin] -f -@ [Threads] [BamDir]/[SeqID].[InputSuffix].bed
  &&
  [ln_bin] -Tsf [bed_gz] [BamDir]/[SeqID].bed.gz
  &&
  [cp_bin] [bed_gz] [final_bed]