# =========================================================
# fastp: Picoplex Gold Library PE Trimming
#  - Optimized for Picoplex Gold (14bp front trimming)
#  - Custom adapter sequences for R1/R2
#  - Singularity-based execution for reproducibility
# =========================================================
tool:
  name: fastp
  version: "0.23.4"
  profile: "PicoplexGold_pe_trim_using_singularity"

io:
  inputs:
    SeqID:        { required: true, help: "Sequence identifier used for file naming and sample tracking" }
    RawFastqDir:  { required: true, help: "Directory containing the raw input FASTQ files" }
    TrimFastqDir: { required: true, help: "Target directory for the processed (trimmed) FASTQ files" }
    qcResDir:     { required: true, help: "Directory for quality control reports (JSON/HTML)" }

  outputs:
    out_read1: { default: '[TrimFastqDir]/[SeqID].trimmed_R1.fastq.gz', help: "Final trimmed Read 1 FASTQ" }
    out_read2: { default: '[TrimFastqDir]/[SeqID].trimmed_R2.fastq.gz', help: "Final trimmed Read 2 FASTQ" }
    json:      { default: '[qcResDir]/[SeqID].fastp.json', help: "JSON format quality report" }
    html:      { default: '[qcResDir]/[SeqID].fastp.html', help: "HTML format quality report" }

params:
  # Binaries & Container
  singularity_bin: { type: str, default: "singularity", help: "Path to the singularity executable" }
  fastp_bin:       { type: str, default: "fastp", help: "fastp executable name or path inside container" }
  sif:             { type: str, default: "/storage/images/fastp-0.23.4.sif", help: "Path to fastp Singularity image (.sif)" }
  bind:            { type: str, default: "/storage,/data", help: "Directories to mount for Singularity" }

  # Resource & Basic Filtering
  Threads:                 { type: int, default: 8, help: "Number of threads for parallel processing" }
  length_required:         { type: int, default: 100, help: "Minimum read length filter" }
  average_qual:            { type: int, default: 10, help: "Minimum average quality filter" }
  qualified_quality_phred: { type: int, default: 15, help: "Phred quality score threshold (base quality)" }

  # Picoplex Gold Specific (14bp front trim)
  trim_front1:             { type: int, default: 14, help: "Number of bases to trim from the start of Read 1" }
  trim_front2:             { type: int, default: 14, help: "Number of bases to trim from the start of Read 2" }

  # Adapter sequences
  adapter_sequence:        { type: str, default: "AGATCGGAAGAGCACACGTCTGAACTCCAGTCA", help: "Adapter sequence for Read 1" }
  adapter_sequence_r2:     { type: str, default: "AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGT", help: "Adapter sequence for Read 2" }

cmd_line: >
  [singularity_bin] exec -B [bind] [sif] [fastp_bin] --thread [Threads]
  --in1 [RawFastqDir]/[SeqID]_R1.fastq.gz --in2 [RawFastqDir]/[SeqID]_R2.fastq.gz
  --out1 [out_read1] --out2 [out_read2]
  --json [json] --html [html]
  --trim_poly_g --detect_adapter_for_pe
  --adapter_sequence [adapter_sequence] --adapter_sequence_r2 [adapter_sequence_r2]
  --length_required [length_required] --average_qual [average_qual] --qualified_quality_phred [qualified_quality_phred]
  --trim_front1 [trim_front1] --trim_front2 [trim_front2]